<!DOCTYPE html>
<html>
  <head>
    <title>Butsubutsu</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
<header class="site-header">
  <div class="header-left">
    <h1>ぶつぶつカレッジ</h1>
  </div>

  <% unless devise_controller? %>
    <nav class="navbar">

      <%# ===== 一覧ページの場合 ===== %>
      <% if controller_name == "trades" && action_name == "index" %>
        <%= link_to "マイページ", mypage_path, class: "nav-btn" %>
        <%= link_to "新規投稿", new_trade_path, class: "nav-btn" %>
        <%= link_to "通知", notifications_path, class: "nav-btn" %>
      <% end %>

      <%# ===== 投稿詳細ページの場合 ===== %>
      <% if controller_name == "trades" && action_name == "show" %>
        <% if request.referer&.include?(notifications_path) %>
         <%= link_to "通知一覧に戻る", notifications_path, class: "nav-btn" %>
        <% elsif session[:from_mypage] %>
         <%= link_to "マイページに戻る", mypage_path, class: "nav-btn" %>
        <% else %>
         <%= link_to "一覧ページに戻る", trades_path, class: "nav-btn" %>
        <% end %>
      <% end %>

      <%# ===== 相手プロフィールページの場合 ===== %>
      <% if controller_name == "users" && action_name == "show" %>
        <% if request.referer&.include?(mypage_path) %>
          <%# マイページから相手プロフィールへ来た場合 %>
          <%= link_to "マイページに戻る", mypage_path, class: "nav-btn" %>
        <% else %>
          <%# それ以外（一覧ページなど） %>
          <%= link_to "一覧ページに戻る", trades_path, class: "nav-btn" %>
        <% end %>
      <% end %>

      <%# ===== その他のページで「一覧ページに戻る」を表示 ===== %>
      <% if !(controller_name == "trades" && action_name == "show") &&
            !(controller_name == "trades" && action_name == "index") &&
            !(controller_name == "users" && action_name == "show") &&
            !(controller_name == "trades" && action_name == "edit") &&        
            !(controller_name == "users" && action_name == "edit_profile") %> 
        <%= link_to "一覧ページに戻る", trades_path, class: "nav-btn" %>
      <% end %>

      <%# ===== 投稿編集ページ ===== %>
      <% if controller_name == "trades" && action_name == "edit" %>
        <%= link_to "投稿詳細に戻る", trade_path(@trade), class: "nav-btn" %>
      <% end %>

      <%# ===== プロフィール編集ページ ===== %>
      <% if controller_name == "users" && action_name == "edit_profile" %>
        <%= link_to "マイページに戻る", mypage_path, class: "nav-btn" %>
      <% end %>

      <%# ===== 共通ログアウトボタン ===== %>
      <% if user_signed_in? %>
        <%= button_to "ログアウト", destroy_user_session_path, method: :delete, class: "nav-btn" %>
      <% end %>

    </nav>
  <% end %>
</header>

    <main>
      <%= yield %>
    </main>
  </body>
</html>
