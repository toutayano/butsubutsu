<h1 class="page-title">投稿詳細</h1>


<div class="trade-card-detail">

  <% if @trade.user != current_user %>
   <!-- 投稿者が自分以外のときだけ表示 -->
   <div class="trade-author">
    <%= link_to user_path(@trade.user), class: "author-link" do %>
      <% if @trade.user.avatar.attached? %>
        <%= image_tag @trade.user.avatar, class: "author-avatar" %>
      <% else %>
        <%= image_tag "default_avatar.png", class: "author-avatar" %>
      <% end %>
    <% end %>
    <span class="author-nickname"><%= @trade.user.nickname %></span>
   </div>
  <% end %>


  <% if @trade.image.attached? %>
    <div class="trade-image-detail-wrapper">
      <div class="trade-image-detail">
        <%= image_tag @trade.image %>
      </div>
    </div>
  <% end %>

  <div class="trade-detail-content">
    <p><strong>商品名:</strong> <%= @trade.name %></p>
    <p><strong>カテゴリー:</strong> <%= @trade.category %></p>
    <p><strong>商品の状態:</strong> <%= @trade.condition %></p>

    <div class="trade-detail">
      <strong>商品の説明:</strong>
      <p><%= simple_format(@trade.detail) %></p>
    </div>

    <p><strong>いいね数:</strong> <%= @trade.likes.count %></p>
    <p><strong>投稿日:</strong> <%= @trade.created_at.strftime("%Y/%m/%d %H:%M") %></p>

    <% if user_signed_in? && current_user == @trade.user %>
      <div class="button-wrapper">
        <%= link_to "投稿を編集", edit_trade_path(@trade), class: "edit-button" %>
        <%= button_to "投稿を削除", trade_path(@trade), method: :delete, class: "delete-button", data: { confirm: "本当に削除しますか？" } %>
      </div>
    <% end %>
  </div>
</div>


<hr>

<h2 class="page-title">メッセージ</h2>

<div class="messages-container">
  <% @messages.each do |message| %>
    <div class="message <%= 'own-message' if message.user_id == current_user&.id %>">
      <strong><%= message.user.nickname %>:</strong>
      <%= message.content %>
      <span class="message-date"><%= message.created_at.strftime("%Y/%m/%d %H:%M") %></span>

      <% if user_signed_in? && message.user_id == current_user.id %>
        <%= button_to "削除", trade_message_path(@trade, message), method: :delete, data: { confirm: "削除しますか？" } %>
      <% end %>
    </div>
  <% end %>
</div>

<% if user_signed_in? %>
  <div class="message-form">
    <%= form_with(model: [@trade, Message.new], local: true) do |f| %>
      <%= f.hidden_field :trade_id, value: @trade.id %>
      <%= f.text_area :content, rows: 3, placeholder: "メッセージを入力..." %>
      <%= f.submit "送信" %>
    <% end %>
  </div>
<% else %>
  <p>メッセージを送るにはログインしてください。</p>
<% end %>